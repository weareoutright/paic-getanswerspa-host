{"version":3,"file":"is-excluded.js","names":["blockListedTypenameParts","seenTypesWhileBlockingByParts","typenamePartIsBlocked","name","typenameContainsBlocklistedPart","find","b","includes","typeIsExcluded","pluginOptions","typeName","type","exclude","fieldIsExcludedOnAll","field","allFieldSettings","__all","excludeFieldNames","fieldIsExcludedOnParentType","parentType","state","getStore","getState","typeMap","remoteSchema","fullType","get","findNamedTypeName","parentTypeNodesField","fields","parentTypeNameSettings","getTypeSettingsByType","parentTypeNodesFieldTypeNameSettings"],"sources":["../../../src/steps/ingest-remote-schema/is-excluded.js"],"sourcesContent":["import { getStore } from \"~/store\"\nimport {\n  findNamedTypeName,\n  getTypeSettingsByType,\n} from \"~/steps/create-schema-customization/helpers\"\n\n// these types do not work in Gatsby because there's no way to reliably invalidate caches or do partial data updates for them\nconst blockListedTypenameParts = [\n  `PluginConnection`,\n  `ThemeConnection`,\n  `ActionMonitorAction`,\n  `EnqueuedScript`,\n  `EnqueuedStylesheet`,\n  `EnqueuedAsset`,\n]\n\nconst seenTypesWhileBlockingByParts = {}\n\nfunction typenamePartIsBlocked(name) {\n  if (seenTypesWhileBlockingByParts[name]) {\n    return seenTypesWhileBlockingByParts[name]\n  }\n\n  const typenameContainsBlocklistedPart = !!blockListedTypenameParts.find(b =>\n    name?.includes(b)\n  )\n\n  seenTypesWhileBlockingByParts[name] = typenameContainsBlocklistedPart\n\n  return typenameContainsBlocklistedPart\n}\n\nconst typeIsExcluded = ({ pluginOptions, typeName }) =>\n  typenamePartIsBlocked(typeName) ||\n  (pluginOptions &&\n    pluginOptions.type[typeName] &&\n    pluginOptions.type[typeName].exclude)\n\nconst fieldIsExcludedOnAll = ({ pluginOptions, field }) => {\n  const allFieldSettings = pluginOptions?.type?.__all\n\n  if (!allFieldSettings) {\n    return false\n  }\n  return !!allFieldSettings?.excludeFieldNames?.includes(field?.name)\n}\n\nconst fieldIsExcludedOnParentType = ({ field, parentType }) => {\n  const state = getStore().getState()\n  const { typeMap } = state.remoteSchema\n\n  const fullType = typeMap.get(findNamedTypeName(parentType))\n\n  const parentTypeNodesField = fullType?.fields?.find(\n    field => field.name === `nodes`\n  )\n\n  const parentTypeNameSettings = getTypeSettingsByType(parentType)\n  const parentTypeNodesFieldTypeNameSettings = getTypeSettingsByType(\n    parentTypeNodesField?.type\n  )\n\n  const fieldIsExcludedOnParentType =\n    // if this field is excluded on either the parent type\n    parentTypeNameSettings?.excludeFieldNames?.includes(field?.name) ||\n    // or the parent type has a \"nodes\" field and that type has this field excluded\n    parentTypeNodesFieldTypeNameSettings?.excludeFieldNames?.includes(\n      field?.name\n    )\n\n  return !!fieldIsExcludedOnParentType\n}\n\nexport { typeIsExcluded, fieldIsExcludedOnAll, fieldIsExcludedOnParentType }\n"],"mappings":";;;;AAAA;AACA;AAKA;AACA,MAAMA,wBAAwB,GAAG,CAC9B,kBAAiB,EACjB,iBAAgB,EAChB,qBAAoB,EACpB,gBAAe,EACf,oBAAmB,EACnB,eAAc,CAChB;AAED,MAAMC,6BAA6B,GAAG,CAAC,CAAC;AAExC,SAASC,qBAAqB,CAACC,IAAI,EAAE;EACnC,IAAIF,6BAA6B,CAACE,IAAI,CAAC,EAAE;IACvC,OAAOF,6BAA6B,CAACE,IAAI,CAAC;EAC5C;EAEA,MAAMC,+BAA+B,GAAG,CAAC,CAACJ,wBAAwB,CAACK,IAAI,CAACC,CAAC,IACvEH,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEI,QAAQ,CAACD,CAAC,CAAC,CAClB;EAEDL,6BAA6B,CAACE,IAAI,CAAC,GAAGC,+BAA+B;EAErE,OAAOA,+BAA+B;AACxC;AAEA,MAAMI,cAAc,GAAG,CAAC;EAAEC,aAAa;EAAEC;AAAS,CAAC,KACjDR,qBAAqB,CAACQ,QAAQ,CAAC,IAC9BD,aAAa,IACZA,aAAa,CAACE,IAAI,CAACD,QAAQ,CAAC,IAC5BD,aAAa,CAACE,IAAI,CAACD,QAAQ,CAAC,CAACE,OAAQ;AAAA;AAEzC,MAAMC,oBAAoB,GAAG,CAAC;EAAEJ,aAAa;EAAEK;AAAM,CAAC,KAAK;EAAA;EACzD,MAAMC,gBAAgB,GAAGN,aAAa,aAAbA,aAAa,8CAAbA,aAAa,CAAEE,IAAI,wDAAnB,oBAAqBK,KAAK;EAEnD,IAAI,CAACD,gBAAgB,EAAE;IACrB,OAAO,KAAK;EACd;EACA,OAAO,CAAC,EAACA,gBAAgB,aAAhBA,gBAAgB,wCAAhBA,gBAAgB,CAAEE,iBAAiB,kDAAnC,sBAAqCV,QAAQ,CAACO,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEX,IAAI,CAAC;AACrE,CAAC;AAAA;AAED,MAAMe,2BAA2B,GAAG,CAAC;EAAEJ,KAAK;EAAEK;AAAW,CAAC,KAAK;EAAA;EAC7D,MAAMC,KAAK,GAAG,IAAAC,eAAQ,GAAE,CAACC,QAAQ,EAAE;EACnC,MAAM;IAAEC;EAAQ,CAAC,GAAGH,KAAK,CAACI,YAAY;EAEtC,MAAMC,QAAQ,GAAGF,OAAO,CAACG,GAAG,CAAC,IAAAC,0BAAiB,EAACR,UAAU,CAAC,CAAC;EAE3D,MAAMS,oBAAoB,GAAGH,QAAQ,aAARA,QAAQ,2CAARA,QAAQ,CAAEI,MAAM,qDAAhB,iBAAkBxB,IAAI,CACjDS,KAAK,IAAIA,KAAK,CAACX,IAAI,KAAM,OAAM,CAChC;EAED,MAAM2B,sBAAsB,GAAG,IAAAC,8BAAqB,EAACZ,UAAU,CAAC;EAChE,MAAMa,oCAAoC,GAAG,IAAAD,8BAAqB,EAChEH,oBAAoB,aAApBA,oBAAoB,uBAApBA,oBAAoB,CAAEjB,IAAI,CAC3B;EAED,MAAMO,2BAA2B;EAC/B;EACA,CAAAY,sBAAsB,aAAtBA,sBAAsB,gDAAtBA,sBAAsB,CAAEb,iBAAiB,0DAAzC,sBAA2CV,QAAQ,CAACO,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEX,IAAI,CAAC,OAChE;EACA6B,oCAAoC,aAApCA,oCAAoC,gDAApCA,oCAAoC,CAAEf,iBAAiB,0DAAvD,sBAAyDV,QAAQ,CAC/DO,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEX,IAAI,CACZ;EAEH,OAAO,CAAC,CAACe,2BAA2B;AACtC,CAAC;AAAA"}