{"version":3,"file":"write-queries-to-disk.js","names":["writeQueriesToDisk","reporter","pluginOptions","debug","graphql","remoteSchema","getStore","getState","schemaWasChanged","activity","activityTimer","formatLogMessage","start","wordPressGraphQLDirectory","process","cwd","fs","rmSync","recursive","force","nodeListQueries","nodeQuery","previewQuery","typeInfo","Object","values","nodeQueries","directory","nodesTypeName","ensureDir","writeFile","prettier","format","parser","nonNodeQuery","end"],"sources":["../../../src/steps/ingest-remote-schema/write-queries-to-disk.js"],"sourcesContent":["import fs from \"fs-extra\"\nimport { getStore } from \"~/store\"\nimport prettier from \"prettier\"\nimport { formatLogMessage } from \"~/utils/format-log-message\"\n\nexport const writeQueriesToDisk = async ({ reporter }, pluginOptions) => {\n  if (!pluginOptions?.debug?.graphql?.writeQueriesToDisk) {\n    return\n  }\n\n  const { remoteSchema } = getStore().getState()\n\n  // the queries only change when the remote schema changes\n  // no need to write them to disk in that case\n  if (!remoteSchema.schemaWasChanged) {\n    return\n  }\n\n  const activity = reporter.activityTimer(\n    formatLogMessage(`writing GraphQL queries to disk at ./WordPress/GraphQL/`)\n  )\n\n  activity.start()\n  const wordPressGraphQLDirectory = `${process.cwd()}/WordPress/GraphQL`\n\n  // remove before writing in case there are old types\n  fs.rmSync(wordPressGraphQLDirectory, {\n    recursive: true,\n    force: true,\n  })\n\n  for (const {\n    nodeListQueries,\n    nodeQuery,\n    previewQuery,\n    typeInfo,\n  } of Object.values(remoteSchema.nodeQueries)) {\n    const directory = `${wordPressGraphQLDirectory}/${typeInfo.nodesTypeName}`\n\n    await fs.ensureDir(directory)\n\n    await fs.writeFile(\n      `${directory}/node-list-query.graphql`,\n      prettier.format(nodeListQueries[0], { parser: `graphql` }),\n      `utf8`\n    )\n\n    await fs.writeFile(\n      `${directory}/node-single-query.graphql`,\n      prettier.format(nodeQuery, { parser: `graphql` }),\n      `utf8`\n    )\n\n    await fs.writeFile(\n      `${directory}/node-preview-query.graphql`,\n      prettier.format(previewQuery, { parser: `graphql` }),\n      `utf8`\n    )\n  }\n\n  const directory = `${wordPressGraphQLDirectory}/RootQuery`\n\n  await fs.ensureDir(directory)\n\n  await fs.writeFile(\n    `${directory}/non-node-root-query.graphql`,\n    prettier.format(remoteSchema.nonNodeQuery, { parser: `graphql` })\n  )\n\n  activity.end()\n}\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AAEO,MAAMA,kBAAkB,GAAG,OAAO;EAAEC;AAAS,CAAC,EAAEC,aAAa,KAAK;EAAA;EACvE,IAAI,EAACA,aAAa,aAAbA,aAAa,uCAAbA,aAAa,CAAEC,KAAK,0EAApB,qBAAsBC,OAAO,kDAA7B,sBAA+BJ,kBAAkB,GAAE;IACtD;EACF;EAEA,MAAM;IAAEK;EAAa,CAAC,GAAG,IAAAC,eAAQ,GAAE,CAACC,QAAQ,EAAE;;EAE9C;EACA;EACA,IAAI,CAACF,YAAY,CAACG,gBAAgB,EAAE;IAClC;EACF;EAEA,MAAMC,QAAQ,GAAGR,QAAQ,CAACS,aAAa,CACrC,IAAAC,kCAAgB,EAAE,yDAAwD,CAAC,CAC5E;EAEDF,QAAQ,CAACG,KAAK,EAAE;EAChB,MAAMC,yBAAyB,GAAI,GAAEC,OAAO,CAACC,GAAG,EAAG,oBAAmB;;EAEtE;EACAC,gBAAE,CAACC,MAAM,CAACJ,yBAAyB,EAAE;IACnCK,SAAS,EAAE,IAAI;IACfC,KAAK,EAAE;EACT,CAAC,CAAC;EAEF,KAAK,MAAM;IACTC,eAAe;IACfC,SAAS;IACTC,YAAY;IACZC;EACF,CAAC,IAAIC,MAAM,CAACC,MAAM,CAACpB,YAAY,CAACqB,WAAW,CAAC,EAAE;IAC5C,MAAMC,SAAS,GAAI,GAAEd,yBAA0B,IAAGU,QAAQ,CAACK,aAAc,EAAC;IAE1E,MAAMZ,gBAAE,CAACa,SAAS,CAACF,SAAS,CAAC;IAE7B,MAAMX,gBAAE,CAACc,SAAS,CACf,GAAEH,SAAU,0BAAyB,EACtCI,iBAAQ,CAACC,MAAM,CAACZ,eAAe,CAAC,CAAC,CAAC,EAAE;MAAEa,MAAM,EAAG;IAAS,CAAC,CAAC,EACzD,MAAK,CACP;IAED,MAAMjB,gBAAE,CAACc,SAAS,CACf,GAAEH,SAAU,4BAA2B,EACxCI,iBAAQ,CAACC,MAAM,CAACX,SAAS,EAAE;MAAEY,MAAM,EAAG;IAAS,CAAC,CAAC,EAChD,MAAK,CACP;IAED,MAAMjB,gBAAE,CAACc,SAAS,CACf,GAAEH,SAAU,6BAA4B,EACzCI,iBAAQ,CAACC,MAAM,CAACV,YAAY,EAAE;MAAEW,MAAM,EAAG;IAAS,CAAC,CAAC,EACnD,MAAK,CACP;EACH;EAEA,MAAMN,SAAS,GAAI,GAAEd,yBAA0B,YAAW;EAE1D,MAAMG,gBAAE,CAACa,SAAS,CAACF,SAAS,CAAC;EAE7B,MAAMX,gBAAE,CAACc,SAAS,CACf,GAAEH,SAAU,8BAA6B,EAC1CI,iBAAQ,CAACC,MAAM,CAAC3B,YAAY,CAAC6B,YAAY,EAAE;IAAED,MAAM,EAAG;EAAS,CAAC,CAAC,CAClE;EAEDxB,QAAQ,CAAC0B,GAAG,EAAE;AAChB,CAAC;AAAA"}