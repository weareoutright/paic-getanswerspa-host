{"version":3,"file":"preview.js","names":["previewStore","createModel","state","nodePageCreatedCallbacks","nodeIdsToCreatedPages","pagePathToNodeDependencyId","reducers","unSubscribeToPagesCreatedFromNodeById","nodeId","subscribeToPagesCreatedFromNodeById","sendPreviewStatus","clearPreviewCallbacks","saveNodePageState","page","path","effects"],"sources":["../../src/models/preview.ts"],"sourcesContent":["// `node` here is a Gatsby node\n\nimport { createModel } from \"@rematch/core\"\nimport { IRootModel } from \".\"\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type OnPageCreatedCallback = (node: any) => Promise<void>\n\nexport interface IStoredPage {\n  path: string\n  updatedAt: number\n}\n\nexport interface IPreviewState {\n  nodePageCreatedCallbacks: {\n    [nodeId: string]: OnPageCreatedCallback\n  }\n  nodeIdsToCreatedPages: {\n    [nodeId: string]: {\n      page: IStoredPage\n    }\n  }\n  pagePathToNodeDependencyId: {\n    [pageId: string]: {\n      nodeId: string\n    }\n  }\n}\n\nexport interface IPreviewReducers {\n  subscribeToPagesCreatedFromNodeById: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n      sendPreviewStatus: OnPageCreatedCallback\n      modified: string\n    }\n  ) => IPreviewState\n  unSubscribeToPagesCreatedFromNodeById: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n    }\n  ) => IPreviewState\n  clearPreviewCallbacks: (state: IPreviewState) => IPreviewState\n  saveNodePageState: (\n    state: IPreviewState,\n    payload: {\n      nodeId: string\n      page: IStoredPage\n    }\n  ) => IPreviewState\n}\n\nconst previewStore = createModel<IRootModel>()({\n  state: {\n    nodePageCreatedCallbacks: {},\n    nodeIdsToCreatedPages: {},\n    pagePathToNodeDependencyId: {},\n  } as IPreviewState,\n\n  reducers: {\n    unSubscribeToPagesCreatedFromNodeById(\n      state,\n      {\n        nodeId,\n      }: {\n        nodeId: string\n      }\n    ) {\n      if (state.nodePageCreatedCallbacks?.[nodeId]) {\n        delete state.nodePageCreatedCallbacks[nodeId]\n      }\n\n      return state\n    },\n\n    subscribeToPagesCreatedFromNodeById(\n      state,\n      {\n        nodeId,\n        sendPreviewStatus,\n      }: {\n        nodeId: string\n        sendPreviewStatus: OnPageCreatedCallback\n        modified: string\n      }\n    ) {\n      // save the callback for this nodeId\n      // when a page is created from a node that has this id,\n      // the callback will be invoked\n      state.nodePageCreatedCallbacks[nodeId] = sendPreviewStatus\n\n      return state\n    },\n\n    clearPreviewCallbacks(state) {\n      state.nodePageCreatedCallbacks = {}\n\n      return state\n    },\n\n    saveNodePageState(\n      state,\n      {\n        page,\n        nodeId,\n      }: {\n        nodeId: string\n        page: IStoredPage\n      }\n    ) {\n      state.nodeIdsToCreatedPages[nodeId] = {\n        page,\n      }\n\n      state.pagePathToNodeDependencyId[page.path] = {\n        nodeId,\n      }\n\n      return state\n    },\n  },\n  effects: () => {\n    return {}\n  },\n})\n\nexport default previewStore\n"],"mappings":";;;;AAEA;AAFA;;AAsDA,MAAMA,YAAY,GAAG,IAAAC,iBAAW,GAAc,CAAC;EAC7CC,KAAK,EAAE;IACLC,wBAAwB,EAAE,CAAC,CAAC;IAC5BC,qBAAqB,EAAE,CAAC,CAAC;IACzBC,0BAA0B,EAAE,CAAC;EAC/B,CAAkB;EAElBC,QAAQ,EAAE;IACRC,qCAAqC,CACnCL,KAAK,EACL;MACEM;IAGF,CAAC,EACD;MAAA;MACA,6BAAIN,KAAK,CAACC,wBAAwB,kDAA9B,sBAAiCK,MAAM,CAAC,EAAE;QAC5C,OAAON,KAAK,CAACC,wBAAwB,CAACK,MAAM,CAAC;MAC/C;MAEA,OAAON,KAAK;IACd,CAAC;IAEDO,mCAAmC,CACjCP,KAAK,EACL;MACEM,MAAM;MACNE;IAKF,CAAC,EACD;MACA;MACA;MACA;MACAR,KAAK,CAACC,wBAAwB,CAACK,MAAM,CAAC,GAAGE,iBAAiB;MAE1D,OAAOR,KAAK;IACd,CAAC;IAEDS,qBAAqB,CAACT,KAAK,EAAE;MAC3BA,KAAK,CAACC,wBAAwB,GAAG,CAAC,CAAC;MAEnC,OAAOD,KAAK;IACd,CAAC;IAEDU,iBAAiB,CACfV,KAAK,EACL;MACEW,IAAI;MACJL;IAIF,CAAC,EACD;MACAN,KAAK,CAACE,qBAAqB,CAACI,MAAM,CAAC,GAAG;QACpCK;MACF,CAAC;MAEDX,KAAK,CAACG,0BAA0B,CAACQ,IAAI,CAACC,IAAI,CAAC,GAAG;QAC5CN;MACF,CAAC;MAED,OAAON,KAAK;IACd;EACF,CAAC;EACDa,OAAO,EAAE,MAAM;IACb,OAAO,CAAC,CAAC;EACX;AACF,CAAC,CAAC;AAAA,eAEaf,YAAY;AAAA"}